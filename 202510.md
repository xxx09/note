# 20251009
- 1. 国庆的训练全部没起来；
安装远程程序；
发现，脚底碰撞体改成了box；【影响非常大, 改为这个return起不来；】如果此时将高度增高0.01【也不行】
脚底碰撞改为自带的collision；【也不行】
脚底碰撞改为8个球体来进行替代；

base_com_range改为了0.05；

新训练，增大action_rate的惩罚；
base_com_range改为0.02；
- 2.
A torso_link, 手侧向和横向；
B 训练的改动，ASAP数据做清洗，用训练后的数据做训练；跟踪点用局部坐标；限制脚踝关节加起来的和小于某个值；
脚踝的力矩做个限制，对部署友好；
奖励：去掉了不少；局部点的跟踪，正则化的一些限制；

上传taichi原始数据；
修改跳舞数据的高度；
beyondmimic和其他的动作；

- 3. 训练泽霖处理过后的数据，用自己的训练分支；
触地部分的mask全部去除掉了；[训练效果一般，不怎么好；]

- 4. beyondmimic处理；

# 20251010
- 1. 训练泽霖的分支
- 2. beyondmimic无法跳转定义
在.vscode/settings.json中添加如下内容；
{
    "python.defaultInterpreterPath": "/home/xxx/anaconda3/envs/beyondmimic/bin/python",
    "python.terminal.activateEnvironment": true,
    "python.analysis.extraPaths": [
        "/home/xxx/workspace/whole_body_tracking/source/whole_body_tracking",
        "/home/xxx/workspace/IsaacLabv21/source/isaaclab"
    ],
    "python.analysis.autoImportCompletions": true,
    "python.analysis.indexing": true
}
- 3. 超参配置
    <default class="HIP">
      <joint stiffness="1" damping="0.1" frictionloss="0.02" armature="0.046"/>
    </default>
    <default class="ANKLE">
      <joint stiffness="1" damping="0.1" frictionloss="0.05" armature="0.0035"/>
    </default>

    g1.py, 需要 armature 电机转子惯性参数；

main.urdf中碰撞体都是用cylinder来替代的；

log["joint_pos] (n, 29)
body_pos_w (n,30,3)
body_quat_w (n,30,3)
body_lin_vel_w (n,30,3)
body_ang_vel_w (n,30,3)



- 4. 
配置mirax3，使用g1.py的超参，armature接近一致；

urdf中可以修改
 <mujoco>
    <compiler meshdir="./meshes/" discardvisual="false"/>
  </mujoco>
  <mesh filename="./meshes/base_link.STL" />
这样可以在mujoco及isaasim中同时加载；而不会报错；

# 20251011
- 1. beyondmimic训练g1跳dance1_2, sim2sim 效果较好；
- 2. git上传弄坏了很多文件，导致重来；注意，git的外名称要一致；
- 3. taichi root_pos处理为从000开始，但quat没处理成功；
- 4. 

# 20251013
- 1. sim2mirax3，有问题， （1）torso_link的idx不一样；
关节顺序都是以isaacsim为主的关节顺序；
joint_pos_rel 是 joint_pos - default_joint_pos, 在isaaclab中进行的定义；

ref_p\v 没问题；
模型验证过了相同的输入输出没有问题；

使用isaacsim的action来驱动mujoco的模型，【该方法在g1的验证中就不行，需要根据当前状态做出实时调整】





g1的定义如下
joint_names
['left_hip_pitch_joint', 'right_hip_pitch_joint', 'waist_yaw_joint', 'left_hip_roll_joint', 'right_hip_roll_joint', 'waist_roll_joint', 'left_hip_yaw_joint', 'right_hip_yaw_joint', 'waist_pitch_joint', 'left_knee_joint', 'right_knee_joint', 'left_shoulder_pitch_joint', 'right_shoulder_pitch_joint', 'left_ankle_pitch_joint', 'right_ankle_pitch_joint', 'left_shoulder_roll_joint', 'right_shoulder_roll_joint', 'left_ankle_roll_joint', 'right_ankle_roll_joint', 'left_shoulder_yaw_joint', 'right_shoulder_yaw_joint', 'left_elbow_joint', 'right_elbow_joint', 'left_wrist_roll_joint', 'right_wrist_roll_joint', 'left_wrist_pitch_joint', 'right_wrist_pitch_joint', 'left_wrist_yaw_joint', 'right_wrist_yaw_joint']
body_names
['pelvis', 'left_hip_pitch_link', 'right_hip_pitch_link', 'waist_yaw_link', 'left_hip_roll_link', 'right_hip_roll_link', 'waist_roll_link', 'left_hip_yaw_link', 'right_hip_yaw_link', 'torso_link', 'left_knee_link', 'right_knee_link', 'left_shoulder_pitch_link', 'right_shoulder_pitch_link', 'left_ankle_pitch_link', 'right_ankle_pitch_link', 'left_shoulder_roll_link', 'right_shoulder_roll_link', 'left_ankle_roll_link', 'right_ankle_roll_link', 'left_shoulder_yaw_link', 'right_shoulder_yaw_link', 'left_elbow_link', 'right_elbow_link', 'left_wrist_roll_link', 'right_wrist_roll_link', 'left_wrist_pitch_link', 'right_wrist_pitch_link', 'left_wrist_yaw_link', 'right_wrist_yaw_link']


mirax3的定义如下
robot joint_names
['left_hip_pitch_joint', 'right_hip_pitch_joint', 'waist_yaw_joint', 'left_hip_roll_joint', 'right_hip_roll_joint', 'left_shoulder_pitch_joint', 'right_shoulder_pitch_joint', 'left_hip_yaw_joint', 'right_hip_yaw_joint', 'left_shoulder_roll_joint', 'right_shoulder_roll_joint', 'left_knee_joint', 'right_knee_joint', 'left_shoulder_yaw_joint', 'right_shoulder_yaw_joint', 'left_ankle_pitch_joint', 'right_ankle_pitch_joint', 'left_elbow_pitch_joint', 'right_elbow_pitch_joint', 'left_ankle_roll_joint', 'right_ankle_roll_joint', 'left_elbow_yaw_joint', 'right_elbow_yaw_joint', 'left_wrist_pitch_joint', 'right_wrist_pitch_joint']

robot body_names
['base_link', 'left_hip_pitch_link', 'right_hip_pitch_link', 'torso_link', 'left_hip_roll_link', 'right_hip_roll_link', 'left_shoulder_pitch_link', 'right_shoulder_pitch_link', 'left_hip_yaw_link', 'right_hip_yaw_link', 'left_shoulder_roll_link', 'right_shoulder_roll_link', 'left_knee_link', 'right_knee_link', 'left_shoulder_yaw_link', 'right_shoulder_yaw_link', 'left_ankle_pitch_link', 'right_ankle_pitch_link', 'left_elbow_pitch_link', 'right_elbow_pitch_link', 'left_ankle_roll_link', 'right_ankle_roll_link', 'left_elbow_yaw_link', 'right_elbow_yaw_link', 'left_wrist_pitch_link', 'right_wrist_pitch_link']

self._scale:
tensor([[0.3784, 0.3784, 0.3733, 0.2270, 0.2270, 0.4386, 0.4386, 0.3733, 0.3733,
         0.4386, 0.4386, 0.3280, 0.3280, 0.4386, 0.4386, 0.2631, 0.2631, 0.4386,
         0.4386, 0.2631, 0.2631, 0.4386, 0.4386, 0.4386, 0.4386],
        [0.3784, 0.3784, 0.3733, 0.2270, 0.2270, 0.4386, 0.4386, 0.3733, 0.3733,
         0.4386, 0.4386, 0.3280, 0.3280, 0.4386, 0.4386, 0.2631, 0.2631, 0.4386,
         0.4386, 0.2631, 0.2631, 0.4386, 0.4386, 0.4386, 0.4386]],
       device='cuda:0')
self._offset:
tensor([[-2.3178e-01, -2.3205e-01,  2.7977e-03, -8.7286e-03, -9.8921e-03,
          2.0644e-01,  1.9755e-01, -1.1900e-01,  1.1448e-01,  5.2672e-02,
         -5.7728e-02,  4.8429e-01,  4.8038e-01,  8.5975e-04,  9.4598e-03,
         -2.3793e-01, -2.3258e-01, -8.0655e-01, -7.9566e-01, -4.0323e-03,
          9.6371e-04,  6.1085e-03,  7.8057e-03,  6.0580e-03,  7.6449e-03],
        [-2.4735e-01, -2.3619e-01, -2.9034e-03,  8.0700e-03, -7.7713e-03,
          1.9813e-01,  1.9469e-01, -1.1258e-01,  1.1759e-01,  5.4866e-02,
         -5.1725e-02,  4.8980e-01,  4.7496e-01, -1.3209e-03,  9.4065e-03,
         -2.4636e-01, -2.4219e-01, -7.9764e-01, -8.0121e-01,  7.6080e-03,
          4.4474e-03,  4.6609e-03, -3.2084e-03, -3.4697e-04, -5.2075e-03]],
       device='cuda:0')



joint_pos_array_seq
array([-0.24, -0.24,  0.  ,  0.  ,  0.  ,  0.2 ,  0.2 , -0.12,  0.12,
        0.05, -0.05,  0.48,  0.48,  0.  ,  0.  , -0.24, -0.24, -0.8 ,
       -0.8 ,  0.  ,  0.  ,  0.  ,  0.  ,  0.  ,  0.  ])

action_scale
array([0.378, 0.378, 0.373, 0.227, 0.227, 0.439, 0.439, 0.373, 0.373,
       0.439, 0.439, 0.328, 0.328, 0.439, 0.439, 0.263, 0.263, 0.439,
       0.439, 0.263, 0.263, 0.439, 0.439, 0.439, 0.439])


- 2. 再训练一个青海摇的

- todo： 按照g1_sim.xml 重写一个mirax_sim.xml, 排除xml带来的影响；

# 20251014
- 1. 继续sim2sim， 按照g1_sim.xml编写了mirax3_sim2.xml，还是没跑通，动作怪异；

很奇怪的现象，
isaacsim中膝关节，给0，一直运动不到位置；且关节角速度一直有，不为0； 从空中掉落也不为0；
mujoco中，运动到位，关节角速度为0；

> **重点：问题是kneelink下的collision，与hip_roll之间有碰撞，导致膝关节运动不到位置；**
[]问题是kneelink下的collision，与hip_roll之间有碰撞，导致膝关节运动不到位置；

关节力矩限制改小为， 120，60，50，100, 30, 30; 手臂都是25；

# 20251015
- 1. todo gmr_v2,训练一版显著抬脚的动作
- 2. 将第一帧数据转换到世界坐标系，注意可用quat进行作用，
- 3. beyondmimic讨论，展示机器人，要进行关节角offset，经常不稳定；后续去顺德出差，进行差异化修改测试；
- 4. 改进方向：
A. 青海摇，GMR转数据可以将下半身弄低一些，可以屈膝，理论上应该更稳定；
修改smplx_to_mirax3.json的human_scale_table中 left_hip由0.9改为0.8，能够达到屈膝的效果；

B. 用训练出来的青海摇play的数据，作为训练数据，继续训练；[已开始训练，训练速度由1个1.4s->2个2.5s]

脚底的orientation降低系数，跟踪不用太严格，因为脚的orientation变化准确度脚底；
随机化torso_link的质量；
修改smplx

# 20251016
- 1. 青海摇clean数据，训练出来的效果没有很大的差异； taichi有点差异，gmr_v2相对手部动作更像，腿部跟踪差一些，整体稳定性高一点；
- 2. 青海摇微屈膝版本
beyondmimic训练qinghaiyaov2版本
推力间隔改为2-8， torso_link 增加质量1-5； 【效果不好，机器人一直往后退】[可能是数据不合理，导致机器人后倾,相同的模型，使用只对yaw旋转的motion，效果更稳定]
- 3. dance1_subject2 166-1088 作为mirax3的训练数据；
使用以前的bvh_to_mirax3.json 会有明显的侧倾斜问题700-720，因此参照pm01重写了json文件，主要区别是降低了torso_link的pos和rot系数，手臂的系数，增加了脚底的位置和旋转系数；

30s的数据，用于验证是否是数据源的问题；
mirax3，新的训练数据dance1_subject2; 【g1在5k时就有了不错的效果，跳舞；】
【第一次训练len先升后下降的厉害，到100左右】， 将effort限制改为150，90，60，130，查看训练效果；

- 4. 重新生成青海摇的mirax3的数据，gmr中config可能也要进行一定的修改； 发现pm1也没修改；

- 5. 训练青海摇_v2, 增加mass随机，增加外力扰动3-6s，增大速度间隔5-8s
没有之前的效果好； taichi也没有之前的效果好；

# 20251017
-1 . 降低运行过程中的推力，增大间隔时间；
qinghaiyaov2,看着似乎更稳定
- 2. 尝试beyondmimic改为多头ppo，基于rsl_rl没有成功，各种报错问题；
todo 用mh_ppo直接替换，修改超参配置，后续查看效果
- 3. 训练青海摇v1和mirax的太极，降低推力，增大间隔；

# 20251019
- 1. qinghaiyaov1没有v2的效果好，同样的配置参数下； taichi和taichi_clean都没有之前的效果好，一直后退的厉害；虽然return很高；
训练青海摇v2，增加一些扰动；训练taichi，
在原始的间隔1-3s的基础上，增加扰动，同时增加躯干的质量随机；同时增加训练环境数为8192；
8192环境的训练速度， 1.8s左右一个epoch
4096环境的训练速度，1.2s左右一个epoch
- 2. 

# 20251020
- 1. sim2sim，从onnx中提取动作，免去导入动作的问题；
- 2. 训练结果；qinghaiyaov2，扰动加大后，整体更稳定；但taichi虽然稳定性增强，但一直往前窜动；身体应该不要有速度；
把mirax3的taichi高度提高一点+0.03，4096，相同的参数配置，重新训练；

- 3. 科技月计划
A）24号进场，27号有个事情，31号演示；
B) 一共4台，第3台即将装好；
越来越好，但实际有问题；动作幅度，
初始会有个旋转，但旋转没起效果；yaw角会旋转；动作幅度；

- 4. qinghaiyao真机测试
不是很稳定，脚底板换为橡胶的变好一点；整体动作很刚，不够柔顺；

容易前倾或者后仰，整体稳定性变差；上半身动作幅度很猛，

域随机化的增加；

修改pid参数，改为和pbhc中一致；
数据序列的长度拉长，目前是46.7s，可以乘以1.5倍；真机测试时

- 5. 分析数据发现，腿部关节基本没有系统延迟，但上半身有大约15帧，即0.02*15=0.3s的系统延迟

质量 -1到5
com的x -0.1到0.1
推力随机1-3s；
数据变慢一倍；

第二个训练，增加系统延迟，actuator是底层实现的，应该是sim_dt*delay_steps；
[40-80]*0.005

# 20251021
- 1. 根据同一组数据观测值中的action和q进行对比，仿真中数据手臂几乎没有延迟；真机中的手臂，每个关节延迟不太一致：j1 12帧，j2 15帧，j3 13帧，j4 5帧； j5 6帧， j6 4帧； 腰 16帧；
- 2. 验证延迟对整体稳定性的影响； sim中，增加了延迟，系统稳定性差很多；
- 3. com的x改回0.025，不额外加质量，原始数据，和v1的设置一样，只不过增加系统延迟；

- 4. 真机验证，slow_delay,启动时会直接失败，因为action过大，导致异常，sim2sim也验证到该问题； v1的8k进行真机infer，整体效果感觉好很多；

增加系统延迟的课程学习
增加对初始状态的采样

使用wzl的分支，训练qinghaiyaov2
pytorch2.7的分支，速度能够到0.9s一个iter；

# 20251022
- 1. mirax3 qinghaiyaov2，手臂前3个关节和后三个关节分开的系统延迟+增加初始状态采样，整体稳定性好很多；
- 2. 分析真机数据，qinghaiyaov2数据
knee: 
hip_pitch 4帧 roll 3帧 yaw  2帧 knee 3帧 ankle 2帧
腿部： 2-4帧 40-80ms

arm_pitch 10帧 roll 13帧 yaw 10帧 elbow 6帧 wrist_yaw 10帧 wrist_pitch 5帧
arm_pitch 10帧 roll 10帧 yaw 10帧 elbow 8帧 wrist_yaw 9帧  wrist_pitch 8帧

总体： 5帧到15帧， 100ms-300ms；
leg: 0.01-0.05
waist 0.15-0.25
arm1 0.14-0.26s
arm2 0.1-0.2s

qinghaiyaov1腿直一些，横向走动打腿概率更低； 添加外力干扰；
8192环境训练 1.35s， 4096训练0.9s
【效果不好，可能是外力干扰？可能是qinghaiyaov1？】


应该修改npz的最后帧，比如延长1s站立的数据，这样在训练结束之后，还能保持稳定；增强系统的稳定性；

- 3. 修改数据
青海摇的数据打脚，那修改原始数据，使得脚底尽量在x轴方向离开一点；
右脚-左脚-左脚-右脚，左脚位置x方向朝前一点；
左脚第980帧到1000帧，y方向增加0.2m；
1000帧到1050帧，y方向增加0.2m；
1050帧到1074帧，y方向继续增加0.1m；
root方向也增加相应的数据；

左脚不动；

# 20251023
- 1. 8192没有很好
- 2. 4096，修改了延迟时间，整体效果稳定很多；
- 3. 训练12288个环境；
后续改action_rate; l2正则项；

# 20251024
- 1. 12288个环境进行测试，动作更到位，会有抬脚底的很多动作；整体的稳定性还可以；
- 2. 会议：后续twist，可以进行开源
所设计即所得，挑战得到认可；
面向应用场景、定产品指标；速度、续航、负载；
专项统筹：袁博，后续拉取资源；

传动链【要有多少个自由度】、驱动链、动态系统、
软件定义硬件、操作和爆发、
数据集发布；

电机测试，最大扭矩等
整体，上半身瘦身，胖乎乎的
屁股电机外露，和抗摔的相关性；
膝盖电机下移；

- 3. 迁移回xxx_train分支，使用4096个环境进行训练，查看是否效果一致；后续基于xxx_train分支训练；
用直接延迟的仿真测试，延迟5帧能稳定，给到10帧不稳定，手臂会乱晃，身体会后退；
整体而言，还是滤波比较接近真机情况；
xxx_train分支应该没什么问题
- 4. 随机初始化，10%概率使用初始关节角，没有加入环境的初始位置！！！
进行修正；

- 5. 训练16384个环境， dance1_subject2, taichi
dance1_subject2能够跳下来
太极右脚支撑时会跳动，

# 20251026
- 1. 训练16384个环境， taichi_v2, action_rate惩罚增大一点 -1e-1到-2e-1

# 20251027
- 1. taichi_v2,没看到支撑脚跳动的情况；等待测试；qinghaiyaov3也等待测试
- 2. 快乐崇拜跳舞数据转换； 将pbhc中的xml改为最新版的手臂，mesh中stl更新了，xml内容也更新了；

# 20251028
- 1. kuailechongbai删掉前40帧，变成v3； action_rate恢复到-1e-1
- 2. 修改kuailechonggbai数据v4，action_rate为-2e-1








