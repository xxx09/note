# 20250711
- 1. feet_slide 可能过大，如果是崎岖地形
- 2. feet_distance 站立时为0.15，似乎存在问题；

# 20250714
- 1. 修改wandb默认参数，symmetric学习(lstm 也许不能和sym共用，因为有中间state)
- 2. locomotion_stand_walk , torchvision 报错，先注释掉相关torchvision内容
- 3. 修改mesh，增加上下楼梯，使用shell脚本，训练sym、lstm两个训练块

# 20250715
- 1. 奖励函数解析
- 2. 腿部关节角曲线生成理解及画图
- 3. height改为0.4->1.2, stair range [0.1,0.23], reset joints by offset, terrain改为curriculum，

# 20250716
- 1. rewards分析
    - Velocity_command: 0.3的概率速度设置为0，小速度重置；所以整体有较大的概率为站立姿态；站立时ref_pos跟踪较好，其他姿态很差，导致整体reward还可以； 站立时，feet_height也比较高，导致不抬脚；
- 2. Legged_gym_x, 
- 3. mujoco中 0.2rad可行走，但0.3rad不行；
- 4. 新的训练，alive=0.2, stand prob 0.1, slope 0.15->0.35, enable_height_scan， base_height=0.72[实际机器人0.3，0.6，0.3时的身高]

# 20250717
- 1. 新的训练推理
- 2. mujoco中场景数量增加；测试可行：5度斜坡，10度斜坡，8cm台阶；
- 3. 新的训练，调整关节角的ref[不使用ref]，terminate惩罚， default_joint_pos修改为(theta_t-theta0, 2), 添加feet_period_force， feet_period_vel； feet_height=0.16, base_com设置

# 20250718
- 1. 新的训练， 添加feet_orientation函数，feet_period_vel只用z方向速度，增大defalut_joint_pos系数，添加no_yaw_roll函数，
- 2. dwl code plan
- 3. 降低feet_orientation、no_yaw_roll函数中exp系数，降低feet_height的rw系数、加大其exp系数; 增加ref_joint系数； hip_yaw的惩罚乘数由0改为0.1；

# 20250721
- 1. 训练观测值加入 height，但不是加入height的历史值， ppo中l90添加了相应的obs_permutation_stack，都置为1；  台阶的高度范围为0.12，设置存在问题；
- 2. PPO 新认识，每次作用到环境的action都是从policy(obs)获取，但获取后需要将其计算图detach；而在ppo实际网络更新时，每次更新都会空跑一次policy.act 以更新网络权值，并获取log_prob；
- 3. Heading_command 设置为True，有高度信息，高度台阶不一样，观测值中含高度信息；【验证state_estimate的有效性】
- 4. todo 打印terrain_levels, 理清terrain_types之间的关系；

# 20250722
- 1. 增加terrain_levels的信息；
- 2. 查看privilege info的合理性； 先写完dwl，训练查看效果之后再调整；
    - A. privilege值中，很多为全身25dof的关节信息，改为12dof，手臂先不管； 总的维度将由 25*7+24=199 降低为 12*7+24=108维
    - B. 手臂的随机动作可以在reset时，设置为更多可能的状态【也可根据课程学习不断的改进】
    - C. resolution=0.15时，11*7， 后续训练要改为0.1，增大对地形的敏感度； 则高度信息为17*11=187， 总维度为108+187=295维
    - D. dwl论文中traing_epoch=2, 目前训练中用的是5;
    - E. 重新采样的时间， 原始为 5.0-8.0, 改为10-14s； 加入了课程学习， friction_range [0.2,1.3]改为[0.1,2.0], 课程学习进入下一阶段的修改；
    - F. 速度由(-0.4, 1.0) -> (-0.4, 1.4)

# 20250723
- 1. dwl的onnx模型导出； dwl模型速度较慢，斜坡和浅台阶都上不去；
- 2. 修改地形的level，划分为20级，更细；修改critic的内容，增加feet_movement信息，12维度；增加torques信息； reample的采样间隔；
- 3. 训练mirax1和mirax2的站立模型； mirax2使用的200HZ，底层电机控制使用的800HZ；随机速度间隔加的较多，随机外力加的间隔也多；

# 20250724
- 1. 先将外力间隔改低，再慢慢添加； return 不高，mujoco中很晃，比isaacsim中要明显很多；[检查发现urdf中imu和mujoco中imu的位姿不一样，后面跟泽霖确认一下]

- 2. self.robot.data.root_vel_w; 站立时惩罚这些值，不让前后左右动，不让其晃动； 
- 3. 修改mira_mujoco_sim导入频率，修改关节角; mujoco本身的控制频率，显示频率，mujoco也用到了RobotDef::DefaultJointPos， 起始的时候用到了设置;
- 4. oreitation绝对值和变化很低，但bae_angle_vel很大，base_root_vel也很大； 添加base_stand_stable函数，奖励站在原地的稳定性,训练mirax1和mirax2
- 5. todo sim2sim的python版本编写

# 20250725
- 1. 还是晃，修改reward函数组成，降低直线部分，增大系数，手臂damping改大；站立的比例百分百； todo 增加torso的惩罚； imu的offset可以关掉；
- 2. 增加shoulder的惩罚，保持恒定，距离更远；

- 3. todo 行走时加入前倾的pitch奖励，可以设置为当前速度和目标速度的差异，【导致向前的加速度】； 为了防止脚内八或者外八，feet相对body的yaw脚应该相等（yaw角有速度时应该不符合该情况）【可能的情况】；
- 4. mujoco sim2sim，多了一种调试工具；尤其是关节角度测试摆动；

# 20250728
- 1. 运行play.py发现新增加的函数shoulder_stand_stable维度不对，但为什么训练时是ok的？？？
- 2. 站立训练，imu的offset关掉，查看效果如何；
- 3. 训练没有加入com_offset初始化，可能会影响训练； friction的加入，目前增加的方式为所有的link全部随机， num_body*3, [friction, static_friction_range, dynamic_friction_range, restitution_range]，isaacgym中则是同一个env，所有的friciton设置成一样； 增加randomize_rigid_body_material属性make_consistent=True；
- 4. 全地形，增加torso_link, base_link 的mass和com的随机化； friction中make_consistent设置为True； privilege增加com_offset，增加之前的电机相关偏置信息； torso增加外扰力和力矩【暂未增加到本体信息内】；

# 20250729
- 1. terrain_level由20改为10，com使用质心，抬腿高度设置为0.1; 效果更差；
- 2. 完善python中的sim2sim.py; 
- 3. 恢复成mirax的地形超参配置,地形个数降低；value_update_freq=3；去掉外力； 降低base和torso_link的
- 4. 去掉scale_body_mass【这个设置不合理！】; 修改地形更新函数【改站立到最后就进入下一个阶段不够严谨； 改降级的目标暂不】； 机器人基本到台阶边缘就不动了；

# 20250730
- 1. 修改更严谨的地形更新函数，link_com去掉; 为了防止脚内八，增加yaw角接近的奖励，保持水平向前；【训练出来了直膝盖行走？？？】
- 2. 调试mirax1：位置超限错误；扯到电线；
- 3. 再训练一次; 同时修改0点位置，left_hip_yaw -0.15, right_hip_yaw 0.15;
- 4. 创建isaacgym的host环境；

# 20250731
- 1. miraX1训练dwl; terrain升的很慢，效果不明显； todo： reconstruction的内容需要进行筛选，不能回归所有内容！【效果不好】
- 2. miraX1训练，加入随机外扰力；【效果不好】
- 3. miraX1训练全地形，只添加随机外扰力间隔[3,5]，不添加速度push；【没有起色】
- 4. miraX1训练全地形，只添加随机外扰力， 间隔增大[8,10]，且只作用在torso_link上；
- 5. 起身，keyframe；

# 20250801
- 1. 修改feet_height和feet_vel的奖励函数，加入系数；使得速度大和高度大时系数增大；训练一版试试看；
- 2. todo：添加reset时push_robot函数；
- 3. mirax1的urdf中head_link有问题，已经修改；mirax1注意ankle_joint的顺序，实际应用和sim中的顺序要做处理；[要改的话，需要在compute_torques中进行关节角顺序的处理]
- - 仿真实际关节角度为roll、pitch；
- - 真机实际关节角度为pitch、roll；


todo: 起身

# Todolist
1. 全地形行走
- 外扰力；(1)随着terrain的升级而更新外扰力；(2)从头开始就加入外扰力；
- dwl；
2. 起身



